<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>青出于蓝家教网-登录</title>
	<!-- 图标 -->
	<link rel="icon" href="images/logo-min.ico" type="image/x-icon" />
	<!-- Bootstrap -->
	<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
	<script src="js/common/jquery-3.4.1.min.js"></script>
	<script src="bootstrap/js/bootstrap.min.js"></script>
	<!--加密解密-->
	<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>-->
	<script src="js/common/crypto-js.js"></script>
	<style>
		body{
			background-color: #fbfbfb;
            overflow-x: hidden;
		}
		.fe-img-1{
			width: 100%; 
			height: 100%;
		}
		.fe-div-1{
			padding: 0 10px 0 10px;
			width: 300px; 
			height: 290px; 
			background-color: rgba(0,0,0,0.4); 
			z-index: 9999; 
			position: absolute;
			top: 140px;
			right: 15%;
		}
		@media screen and (max-width: 768px) {
			.fe-div-1{
				padding: 0 10px 0 10px;
				width: 300px;
				height: 290px;
				background-color: rgba(0,0,0,0.4);
				z-index: 9999;
				position: absolute;
				top: 140px;
				right: 11%;
			}
		}
		.fe-div-2{
			padding-right: 10px; 
			height: 35px;
			line-height: 35px;
			color: white;
			text-align: right;
			width: 20%;
			float: left;
		}
		.fe-div-3{
			height: 40px;
			line-height: 40px;
			color: white;
			margin-top: 10px;
			margin-bottom: 20px;
			border-bottom: white solid 1px;
		}
		.fe-div-4{
			width: 80%;
			float: left;
			height: 35px;
			padding-right: 10px;
		}
		.fe-a-1{
			color: white;
			font-size: 1.2rem;
		}
		.fe-a-1:hover{
			text-decoration: none;
			color: #f0ad4e;
		}
		.fe-p-1{
			color: red;
			height: 18px;
			line-height: 18px;
			margin: 0;
			padding-left: 56px;
		}
		.fe-margin-1{
			margin-bottom: 0px;
		}
	</style>
</head>
<body>
	<div class="fe-div-1">
		<div class="fe-div-3">
			<p>用户登录</p>
		</div>
		<form role="form" id="login" onsubmit="return false" class="form-horizontal" role="form">
			<div class="fe-p-1 col-md-12" id="unametip"><!--js插入--></div>
			<div class="form-group col-md-12 fe-margin-1">
				<div class="fe-div-2">
					<label class="control-label" style="padding-top: 0px;" for="loginname">账号</label>
				</div>				
				<div class="fe-div-4">
					<input type="text" class="form-control" id="loginname" name="uname" placeholder="用户名/ID/手机号" type="text" required onblur="unameCheck()" maxlength="11" autocomplete="off" />
				</div>
			</div>
			<div class="fe-p-1 col-md-12" id="pwdtip"><!--js插入--></div>
			<div class="form-group col-md-12 fe-margin-1">
				<div class="fe-div-2">
					<label class="control-label" style="padding-top: 0px;" for="loginpwd">密码</label>
				</div>				
				<div class="fe-div-4">
					<input class="form-control" id="loginpwd" name="pwd" type="password" required maxlength="12" />
				</div>
			</div>
			<div class="form-group col-md-12" style="margin-top: 18px;">
				<div class="fe-div-2"></div>
				<div class="fe-div-4">
					<button type="button" class="btn btn-warning" style="width: 100%;" onclick="loginCheck()">登录</button>
				</div>
			</div>
			<div class="form-group col-md-12">
				<div class="fe-div-2"></div>
				<div class="fe-div-4 text-right" style="padding-top: 10px;">
					<a class="fe-a-1" href="html/fe-register.html">立即注册</a><span style="color: white;"> | </span><a class="fe-a-1" href="html/modify-pwd.html">忘记密码?</a>
				</div>
			</div>
		</form>
	</div>
<div class="container-fluid">
	<div class="row">
		<div class="col-md-12" style="height: 52px;margin-top: 40px;margin-bottom: 15px;">
			<img src="../carousel/logo-2.png" />
		</div>
	</div>
	<div class="row">
		<div id="myCarousel" class="carousel slide" style="width: 100%;">
			<!-- 轮播（Carousel）指标 -->
			<ol class="carousel-indicators">
				<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
				<li data-target="#myCarousel" data-slide-to="1"></li>
				<li data-target="#myCarousel" data-slide-to="2"></li>
				<li data-target="#myCarousel" data-slide-to="3"></li>
				<li data-target="#myCarousel" data-slide-to="4"></li>
			</ol>   
		
			<!-- 轮播（Carousel）项目 -->
			<div class="carousel-inner">
				<div class="item active">
				<img class="fe-img-1" src="../carousel/first.jpg" alt="First slide">
				</div>
				<div class="item">
				<img class="fe-img-1" src="../carousel/second.jpg" alt="Second slide">
				</div>
				<div class="item">
				<img class="fe-img-1" src="../carousel/third.jpg" alt="Third slide">
				</div>
				<div class="item">
				<img class="fe-img-1" src="../carousel/fourth.jpg" alt="Four slide">
				</div>
				<div class="item">
				<img class="fe-img-1" src="../carousel/fifth.jpg" alt="Fifth slide">
				</div>
			</div>
			<!-- 轮播（Carousel）导航 -->
			<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
			    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
			    <span class="sr-only">Previous</span>
			</a>
			<a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
			    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
			    <span class="sr-only">Next</span>
			</a>
		</div>
	</div>
</div>

<script>
	$(function(){
		$("#myCarousel").carousel('cycle');
	});
</script>
	<script>
        function unameCheck() {
            var uname = $("#loginname").val();
            $.ajax({
                type:"get",
                url:"/unameCheck",
                data:{uname : uname},
                dataType:"text",
                success:function(data){
                    if(data=="noUser"){
                        $("#unametip").html("用户不存在");
                    }else if(data=="exist"){
                        $("#unametip").html("");
                    }

                }
            })
        }
        function loginCheck() {
            var uname = $("#loginname").val();				//从登录表单获取用户名（或手机号）
            var pwd = $("#loginpwd").val();					//从登录表单获取密码
            $.ajax({										//对用户名（或手机号进行校验）
                type:"get",									//请求方式
                url:"/loginCheck",							//校验请求地址
                data:{uname : uname, pwd : pwd},			//请求数据
                dataType:"text",							//返回数据类型
                success:function(data){						//请求成功回调函数
                    if(data=="noUser"){						//若用户不存在
                        $("#unametip").html("用户不存在");
                    }else if(data=="pwdError"){				//若密码不正确
                        $("#pwdtip").html("密码不正确");
                    }else if(data=="disabled"){				//若用户处封禁状态
                        $("#unametip").html("用户已封禁");
                    }else if(data=="success"){				//若校验成功
						$.ajax({							//校验成功后进行登录操作
							type:"get",
							url:"/login",
							data:$("#login").serialize(),
							dataType:"json",
							success:function (userInfo) {
							    var uid = userInfo.uid;
							    var power = userInfo.power;
							    window.localStorage.setItem("power",power);
                                window.localStorage.setItem("uid",uid);
                                window.localStorage.setItem("uname",uname);
							    switch (power){
									case 1:
                                        toFe_workPage(uid);
                                        break;
									case 2:
                                        toFe_tutorPage(uid);
                                        break;
									case 3:
									    toManagerHomePage();
									    break;
								}
                            },
							error:function () {				//请求失败回调函数
								alert("登录失败");
                            }
						})
                    }
                }
            })
        }

        function toFe_tutorPage(uid) {
            var aseKey = "12345678" //秘钥必须为：8/16/32位
            var encrypt = CryptoJS.AES.encrypt(uid, CryptoJS.enc.Utf8.parse(aseKey), {
                mode: CryptoJS.mode.ECB,
                padding: CryptoJS.pad.Pkcs7
            }).toString();
            window.location.href="/html/infoissue/fe-tutor-resume.html?uid="+encrypt;
        }
        function toFe_workPage(uid) {
            var aseKey = "12345678" //秘钥必须为：8/16/32位
            var encrypt = CryptoJS.AES.encrypt(uid, CryptoJS.enc.Utf8.parse(aseKey), {
                mode: CryptoJS.mode.ECB,
                padding: CryptoJS.pad.Pkcs7
            }).toString();
            window.location.href="/html/infoissue/fe-tutor-recruit.html?uid="+encrypt;
        }
        function toManagerHomePage() {
            window.location.href="/html/admin/manage-home.html";
		}
	</script>
</body>
</html>